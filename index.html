<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Death Note</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    /* === FONT DEATH NOTE === */
    @font-face {
      font-family: "DeathNoteMain";
      src: url("assets/fonts/DEATHNOTEFont.ttf") format("truetype");
      font-weight: normal;
      font-style: normal;
    }
    @font-face {
      font-family: "DeathNotePage";
      src: url("assets/fonts/DeathNote.ttf") format("truetype");
      font-weight: normal;
      font-style: normal;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow-x: hidden;
      font-family: "DeathNoteMain", serif;
      background: url("assets/img/paper_texture.jpg");
      background-size: cover;
      background-position: center;
      filter: brightness(0.85);
    }

    .riddle-inner,
    .riddle-inner .riddle-text,
    .riddle-inner .riddle-footer {
      font-family: "DeathNotePage", serif !important;
    }

    .overlay-title {
      position: fixed;
      top: 60px;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: center;
      z-index: 20;
    }

    .blood-title {
      font-size: clamp(2.8rem, 6vw, 6rem);
      color: #ff1a1a;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      text-shadow:
        2px 2px 0 #000,
        4px 4px 0 #000,
        6px 6px 0 #000,
        8px 8px 0 #000,
        10px 10px 0 #000,
        -3px -3px 0 #000,
        3px -3px 0 #000,
        -3px 3px 0 #000,
        3px 3px 0 #000,
        0 0 15px rgba(255,0,0,1),
        0 0 40px rgba(255,0,0,0.9),
        0 0 80px rgba(255,0,0,0.8);
    }

    .scene {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 5;
      padding: 3rem;
      min-height: calc(100vh - 6rem);
      box-sizing: border-box;
    }

    .riddle-container {
      position: relative;
      width: min(60vw, 650px);
      margin-top: 150px;
      margin-right: 500px;
      z-index: 10;
    }

    .riddle-page {
      position: relative;
      width: 100%;
      box-shadow: 0 35px 80px rgba(0, 0, 0, 0.9);
      border-radius: 10px;
      overflow: hidden;
      transform: rotate(-2deg);
      background: #000;
      animation: floatBook 4.5s ease-in-out infinite;
      cursor: pointer;
    }
    
    @keyframes floatBook {
      0%, 100% {
        transform: rotate(-2deg) translateY(0);
        box-shadow: 0 35px 80px rgba(0, 0, 0, 0.9);
      }
      50% {
        transform: rotate(-2deg) translateY(-8px);
        box-shadow: 0 45px 90px rgba(0, 0, 0, 0.7);
      }
    }

    .riddle-page img {
      display: block;
      width: 100%;
      height: auto;
      border-radius: inherit;
    }

    .riddle-inner {
      position: absolute;
      top: 22%;
      left: 12%;
      right: 10%;
      bottom: 12%;
      color: #ffffff;
      font-size: clamp(1.5rem, 1.55vw, 1.45rem);
      line-height: 1.65;
      letter-spacing: 0.04em;
      text-shadow: 0 0 4px rgba(0,0,0,0.75);
    }

    .riddle-text {
      white-space: pre-line;
      overflow: hidden;
    }
        
    img {
      user-select: none;
      -webkit-user-drag: none;
    }

    .riddle-footer {
      margin-top: 1rem;
      font-size:clamp(1.4rem,2vw,2rem);
      color: #ff0000;
      text-align: right;
      text-shadow: 0 0 6px rgba(255,0,0,0.8);
    }

    /* === RYUK 3D ANIMACIÓN DE APARICIÓN === */
    model-viewer {
      position: absolute;
      top: 50%;
      left: 40%;
      width: 80vw;
      height: 100vh;
      z-index: 5;
      pointer-events: none;
      filter: drop-shadow(0px 0px 60px rgba(252, 89, 89, 0.4));

      opacity: 0;
      transform: translate(-10%, -50%) scale(0.4);
      transition: opacity 1.3s ease, transform 1.3s ease;
    }

    model-viewer.show {
      opacity: 1;
      transform: translate(-10%, -50%) scale(1.4);
      pointer-events: auto;
      cursor: pointer;
    }

    @media (max-width: 1024px) {
      .scene {
        gap: 3vw;
      }
      .riddle-container {
        width: min(50vw, 500px);
      }
      model-viewer {
        width: min(45vw, 480px);
        height: 60vh;
      }
    }

    @media (max-width: 900px) {
      body {
        overflow-y: auto;
      }
      .scene {
        flex-direction: column;
        gap: 2rem;
        padding: 1.5rem 5vw 2.5rem;
      }
      .riddle-container {
        width: 90vw;
        margin-right: 0;
      }
      .riddle-inner {
        font-size: clamp(1rem, 3vw, 1.2rem);
      }
      model-viewer {
        width: 90vw;
        height: 55vh;
      }
    }
  </style>
</head>

<body>

  <!-- TÍTULO -->
  <div class="overlay-title">
    <div class="blood-title">DEATH NOTE</div>
  </div>

  <div class="scene">

    <!-- LIBRO -->
    <div class="riddle-container">
      <div class="riddle-page">
        <img src="assets/img/deathnote_page.jpg" alt="Death Note page">
        <div class="riddle-inner">
          <div class="riddle-text">
            Quien ose tocar la Death Note,
            sea o no su dueno,
            despertara la vision maldita:
            el Shinigami original aparecerá
            ante sus ojos.
            Todo nombre trazado en estas paginas
            sellará un destino:
            la muerte inevitable del portador.
            La libreta solo obedece
            cuando el escritor invoca en su mente
            el rostro verdadero de la víctima.
            Los nombres iguales
            no engañaran a la muerte.
            El humano que emplee esta libreta
            quedara para siempre excluido
            del Cielo y del Infierno.
            
          </div>
          <div class="riddle-footer">— Sabias que...</div>
        </div>
      </div>
    </div>

    <!-- RYUK 3D -->
    <model-viewer
      src="assets/models/ryuk.glb"
      camera-controls
      auto-rotate
      rotation-per-second="25deg"
      shadow-intensity="1"
      exposure="1.2"
      disable-zoom="false"
      ar="false"
      interaction-prompt="none"
    ></model-viewer>

  </div>

  <!-- AUDIO -->
  <audio id="bg-music" src="assets/audio/deathnote_theme.mp3" loop></audio>
  <audio id="ryuk-laugh" src="assets/audio/ryuk_laugh.mp3"></audio>

  <!-- SCRIPT CON MUSICA + RISATA + DOWNLOAD -->
  <script>
    const book = document.querySelector(".riddle-page");
    const ryuk = document.querySelector("model-viewer");
    const music = document.getElementById("bg-music");
    const laugh = document.getElementById("ryuk-laugh");

    // Funzione per il fade-in della musica
    function fadeInAudio(audio, targetVolume = 0.7, step = 0.03, interval = 100) {
      audio.volume = 0;
      let v = 0;
      const fade = setInterval(() => {
        v += step;
        if (v >= targetVolume) {
          v = targetVolume;
          clearInterval(fade);
        }
        audio.volume = v;
      }, interval);
    }

    book.addEventListener("click", (event) => {
      event.stopPropagation();
      ryuk.classList.add("show");

      // Avvia la musica con fade-in
      music.play()
        .then(() => {
          fadeInAudio(music, 0.7, 0.03, 100);
        })
        .catch(e => {
          console.log("Autoplay bloccato dal browser finche l'utente non interagisce pienamente:", e);
        });
    });

    ryuk.addEventListener("click", (event) => {
      event.stopPropagation();

      // Risata di Ryuk
      laugh.currentTime = 0;
      laugh.play().catch(e => console.log("Impossibile riprodurre la risata:", e));

      // Download del file zip dopo un piccolo delay
      setTimeout(() => {
        const downloadLink = document.createElement('a');
        downloadLink.href = 'Death-Note.zip';
        downloadLink.download = 'Death-Note.zip';
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);
      }, 800); // 0.8 secondi
    });
  </script>

</body>
</html>
